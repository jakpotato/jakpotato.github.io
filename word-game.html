<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Daily Fun Fact</title>

<style>
:root {
  --bg: #f6f7f8;
  --card: #ffffff;
  --text: #1f2937;
  --muted: #6b7280;
  --key: #e5e7eb;
  --correct: #22c55e;
  --wrong: #f97316;
}

[data-theme="dark"] {
  --bg: #0f172a;
  --card: #020617;
  --text: #e5e7eb;
  --muted: #94a3b8;
  --key: #1e293b;
  --correct: #4ade80;
  --wrong: #fb923c;
}

@keyframes reveal {
  0% { transform: scale(0.8); opacity: 0; }
  60% { transform: scale(1.1); opacity: 1; }
  100% { transform: scale(1); }
}

* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: var(--bg);
  color: var(--text);
}

.app {
  max-width: 480px;
  margin: 0 auto;
  padding: 16px 16px 140px;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.card {
  background: var(--card);
  border-radius: 16px;
  padding: 16px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.06);
}

.controls { margin-bottom: 12px; }

input[type="date"], button {
  padding: 8px 10px;
  border-radius: 10px;
  border: none;
  background: var(--key);
  color: var(--text);
}

.question { font-size: 1.1rem; margin-bottom: 12px; }

.answer {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin-bottom: 8px;
}

.word {
  display: flex;
  justify-content: center;
  gap: 6px;
  flex-wrap: nowrap; /* NEVER wrap letters */
  overflow: hidden;   /* prevent overflow */
}

.letter {
  min-width: 36px;
  height: 44px;
  font-size: 1.5rem;  /* default font size */
  font-weight: 600;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: font-size 0.2s ease;
}

.hidden {
  border-bottom: 3px solid var(--muted);
}

.revealed {
  animation: reveal 0.25s ease-out;
}

.score {
  text-align: right;
  font-size: 1rem;
  /* margin-bottom: 12px; */
}

.meta {
  text-align: center;
  font-size: 0.9rem;
  color: var(--muted);
}

.explanation {
  margin-top: 12px;
  font-style: italic;
}

/* Keyboard */
.keyboard {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: var(--card);
  padding: 12px 8px 16px;
  box-shadow: 0 -10px 25px rgba(0,0,0,0.1);
}

.key-row {
  display: flex;
  justify-content: center;
  gap: 6px;
  margin-bottom: 6px;
}

.key {
  flex: 1;
  max-width: 42px;
  padding: 12px 0;
  border-radius: 8px;
  background: var(--key);
  text-align: center;
  font-weight: 600;
  user-select: none;
  transition: all 0.2s ease;
}

.key.correct { background: var(--correct); color: white; }
.key.wrong {
  background: var(--wrong);
  color: white;
  transform: translateY(2px);
}
.key.disabled { pointer-events: none; }
</style>
</head>

<body>
<div class="app">
  <div class="header">
    <h1>Daily Fun Fact</h1>
    <button id="darkToggle">ðŸŒ™</button>
  </div>

  <div class="card">
    <div class="controls">
      <input type="date" id="datePicker">
      <div class="score" id="score">Score: 0</div>
    </div>

    <div class="question" id="question"></div>
    <div class="answer" id="answer"></div>
    <!-- <div class="score" id="score"></div> -->
    <div class="meta" id="meta"></div>
    <div class="explanation" id="explanation"></div>
  </div>
</div>

<div class="keyboard" id="keyboard"></div>

<script>
const QWERTY = ["qwertyuiop","asdfghjkl","zxcvbnm"];
const today = new Date().toLocaleDateString('en-CA');
let facts = {}, current, revealed=[], prevRevealed=[], points=0;

async function loadFacts(){
  const res=await fetch("facts.txt");
  const text=await res.text();
  text.split("\n").forEach(line=>{
    if(!line.trim())return;
    const [date,q,a,e]=line.split("|").map(s=>s.trim());
    facts[date]={date,q,a,e};
  });
}

function key(date){return `fact-${date}`;}
function saved(date){return JSON.parse(localStorage.getItem(key(date))||"null");}
function save(date){localStorage.setItem(key(date),JSON.stringify({completed:true,points}));}

function start(date){
  current=facts[date];
  const s=saved(date);
  points=0;

  document.getElementById("question").textContent=current.q;
  document.getElementById("explanation").textContent="";
  document.getElementById("meta").textContent="";

  revealed=current.a.split("").map(ch=>ch===" ");
  prevRevealed=[...revealed];

  if(s?.completed){
    revealed=revealed.map(()=>true);
    points=s.points;
    document.getElementById("meta").textContent="âœ” Completed";
    document.getElementById("explanation").textContent=current.e;
    buildKeyboard(true);
  } else buildKeyboard(false);

  drawAnswer();
  updateScore();
}

function drawAnswer() {
  const wrap = document.getElementById("answer");
  wrap.innerHTML = "";
  let index = 0;

  current.a.split(" ").forEach(word => {
    const row = document.createElement("div");
    row.className = "word";

    // Only shrink if single-word answer
    if(current.a.split(" ").length === 1 && word.length > 8){
      // Dynamically shrink font to fit container
      const containerWidth = wrap.clientWidth;
      const desiredFontSize = Math.min(1.5, containerWidth / (word.length * 36)) + "rem";
      row.style.fontSize = desiredFontSize;
    } else {
      row.style.fontSize = ""; // default
    }

    word.split("").forEach(() => {
      const d = document.createElement("div");
      d.className = "letter";

      if(revealed[index]){
        d.textContent = current.a[index].toUpperCase();
        if(!prevRevealed[index]) d.classList.add("revealed");
      } else {
        d.classList.add("hidden");
      }

      index++;
      row.appendChild(d);
    });

    wrap.appendChild(row);
    index++; // skip space
  });

  prevRevealed = [...revealed];
}


function buildKeyboard(disabled){
  const kb=document.getElementById("keyboard");
  kb.innerHTML="";
  QWERTY.forEach(row=>{
    const r=document.createElement("div");
    r.className="key-row";
    row.split("").forEach(l=>{
      const k=document.createElement("div");
      k.className="key";
      k.textContent=l.toUpperCase();
      if(!disabled) k.onclick=()=>guess(l,k);
      else k.classList.add("disabled");
      r.appendChild(k);
    });
    kb.appendChild(r);
  });
}

function guess(letter,key){
  let hit=false;
  current.a.toLowerCase().split("").forEach((ch,i)=>{
    if(ch===letter){revealed[i]=true;hit=true;}
  });

  key.classList.add(hit?"correct":"wrong","disabled");
  points+=hit?1:-1;

  drawAnswer();
  updateScore();

  if(revealed.every(v=>v)){
    document.getElementById("explanation").textContent=current.e;
    document.getElementById("meta").textContent="ðŸŽ‰ Answer revealed!";
    document.querySelectorAll(".key").forEach(k=>k.classList.add("disabled"));
    save(current.date);
  }
}

function updateScore(){
  document.getElementById("score").textContent=`Score: ${points}`;
}

document.getElementById("darkToggle").onclick=()=>{
  const t=document.documentElement.dataset.theme==="dark"?"light":"dark";
  document.documentElement.dataset.theme=t;
  localStorage.setItem("theme",t);
};

(async()=>{
  const t=localStorage.getItem("theme");
  if(t)document.documentElement.dataset.theme=t;

  await loadFacts();
  const picker=document.getElementById("datePicker");
  picker.value=today; picker.max=today;
  picker.onchange=()=>start(picker.value);
  start(today);
})();
</script>
</body>
</html>
