<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Daily Fun Fact</title>
<style>
:root {
  --bg: #f6f7f8;
  --card: #ffffff;
  --text: #1f2937;
  --muted: #6b7280;
  --accent: #3b82f6;
  --key: #e5e7eb;
  --key-disabled: #9ca3af;
  --correct: #22c55e; /* green */
  --wrong: #f97316; /* muted orange */
}

[data-theme="dark"] {
  --bg: #0f172a;
  --card: #020617;
  --text: #e5e7eb;
  --muted: #94a3b8;
  --accent: #60a5fa;
  --key: #1e293b;
  --key-disabled: #475569;
  --correct: #4ade80; 
  --wrong: #fb923c;
}

* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background: var(--bg);
  color: var(--text);
  display: flex;
  justify-content: center;
  padding: 16px;
}

.app { width: 100%; max-width: 480px; }

.header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }

.card { background: var(--card); border-radius: 16px; padding: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }

h1 { font-size: 1.25rem; margin: 0; }

.controls { display: flex; gap: 8px; margin-bottom: 12px; }

input[type="date"], button { padding: 8px 10px; border-radius: 10px; border: none; background: var(--key); color: var(--text); }

button { cursor: pointer; }

.question { font-size: 1.1rem; margin-bottom: 16px; }

.answer { display: flex; flex-wrap: wrap; justify-content: center; margin-bottom: 16px; }

.letter {
  width: 32px;
  height: 40px;
  margin: 3px;
  font-size: 1.4rem;
  font-weight: 600;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.3s ease;
}

.hidden { border-bottom: 2px solid var(--muted); }
.space { width: 16px; }

.keyboard { display: flex; flex-direction: column; gap: 6px; margin-bottom: 12px; }
.key-row { display: flex; justify-content: center; gap: 6px; }
.key {
  width: var(--key-size);
  height: var(--key-size);
  border-radius: 10px;
  background: var(--key);
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  cursor: pointer;
  user-select: none;
  transition: all 0.2s ease;
}
.key.disabled { cursor: default; }
.key.correct { background: var(--correct); color: white; }
.key.wrong { background: var(--wrong); color: white; transform: translateY(1px); }

.meta { margin-top: 4px; text-align: center; font-size: 0.9rem; color: var(--muted); }
.explanation { margin-top: 12px; font-style: italic; }

.notice { text-align: center; padding: 16px; }
</style>
</head>

<body>
<div class="app">
  <div class="header">
    <h1>Daily Fun Fact</h1>
    <button id="darkToggle">ðŸŒ™</button>
  </div>

  <div class="card">
    <div class="controls">
      <input type="date" id="datePicker" />
    </div>

    <div id="content">
      <div class="question" id="question"></div>
      <div class="answer" id="answer"></div>
      <div class="keyboard" id="keyboard"></div>
      <div class="meta" id="meta"></div>
      <div class="meta" id="points"></div>
      <div class="explanation" id="explanation"></div>
    </div>

    <div class="notice" id="notice" style="display:none;"></div>
  </div>
</div>

<script>
const QWERTY = ["qwertyuiop","asdfghjkl","zxcvbnm"];
const today = new Date().toISOString().slice(0,10);
let facts = {}, current, revealed=[], points=0;

async function loadFacts() {
  const res = await fetch("facts.txt");
  const text = await res.text();
  text.split("\n").forEach(line => {
    if(!line.trim()) return;
    const [date,q,a,e] = line.split("|").map(s=>s.trim());
    facts[date]={date,q,a,e};
  });
}

function storageKey(date){return `fact-${date}`;}
function loadSaved(date){const raw=localStorage.getItem(storageKey(date));return raw?JSON.parse(raw):null;}
function saveCompleted(date){localStorage.setItem(storageKey(date),JSON.stringify({completed:true, points}));}

function startFact(date){
  const notice=document.getElementById("notice");
  const content=document.getElementById("content");
  notice.style.display="none"; content.style.display="block";

  if(!facts[date]){
    const earliest=Object.keys(facts).sort()[0];
    content.style.display="none"; notice.style.display="block";
    notice.textContent=`No fact for this date. The first fact is on ${earliest}.`;
    return;
  }

  current=facts[date];
  document.getElementById("question").textContent=current.q;
  document.getElementById("explanation").textContent="";
  document.getElementById("meta").textContent="";
  points=0;

  const saved=loadSaved(date);
  revealed=current.a.split("").map(ch=>ch===" ");
  if(saved?.completed){revealed=revealed.map(()=>true); points=saved.points; document.getElementById("meta").textContent="âœ” Completed"; document.getElementById("explanation").textContent=current.e; renderKeyboard(true);}else{renderKeyboard(false);}
  renderAnswer();
  updatePoints();
}

function renderAnswer(){
  const el=document.getElementById("answer"); el.innerHTML="";
  current.a.split("").forEach((ch,i)=>{
    const d=document.createElement("div"); d.className="letter";
    if(ch===" ") d.classList.add("space");
    else if(revealed[i]) {d.textContent=ch.toUpperCase(); d.style.background=""; d.style.color="";}
    else d.classList.add("hidden");
    el.appendChild(d);
  });
}

function renderKeyboard(disabled){
  const kb=document.getElementById("keyboard"); kb.innerHTML="";
  QWERTY.forEach(row=>{
    const rowEl=document.createElement("div"); rowEl.className="key-row";
    row.split("").forEach(l=>{
      const k=document.createElement("div"); k.className="key";
      if(disabled) k.classList.add("disabled");
      k.textContent=l.toUpperCase(); k.onclick=()=>selectLetter(l,k);
      rowEl.appendChild(k);
    });
    kb.appendChild(rowEl);
  });
}

function selectLetter(letter,key){
  if(key.classList.contains("disabled")) return;
  let hit=false;
  current.a.toLowerCase().split("").forEach((ch,i)=>{if(ch===letter){revealed[i]=true;hit=true;}});
  if(hit) key.classList.add("correct"); else key.classList.add("wrong");
  key.classList.add("disabled");
  points+=hit?1:-1;
  updatePoints();
  renderAnswer();
  if(revealed.every(v=>v)){
    document.getElementById("explanation").textContent=current.e;
    document.getElementById("meta").textContent="ðŸŽ‰ Answer revealed!";
    document.querySelectorAll(".key").forEach(k=>k.classList.add("disabled"));
    saveCompleted(current.date);
  }
}

function updatePoints(){document.getElementById("points").textContent=`Score: ${points}`;}

function initDarkMode(){
  const saved=localStorage.getItem("theme");
  const prefersDark=window.matchMedia("(prefers-color-scheme: dark)").matches;
  const theme=saved||(prefersDark?"dark":"light");
  document.documentElement.dataset.theme=theme;
  document.getElementById("darkToggle").onclick=()=>{
    const next=document.documentElement.dataset.theme==="dark"?"light":"dark";
    document.documentElement.dataset.theme=next;
    localStorage.setItem("theme",next);
  };
}

(async function init(){
  initDarkMode();
  await loadFacts();
  const picker=document.getElementById("datePicker");
  picker.value=today; picker.max=today; picker.onchange=()=>startFact(picker.value);
  startFact(today);
})();
</script>
</body>
</html>
